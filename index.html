<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YOUSSEF PROTOCOL - Growth System</title>
    <!-- Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --brand-blue: #2eaadc;
            --bg-deep: #0F0F0F;
            --bg-card: #141414;
            --border-subtle: rgba(255, 255, 255, 0.05);
            --cat-business: #10B981;
            --cat-fitness: #F43F5E;
            --cat-learning: #F59E0B;
            --cat-spirituality: #8B5CF6;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-deep);
            color: #ffffff;
            overflow: hidden;
            -webkit-font-smoothing: antialiased;
        }

        .glass-sidebar {
            background: rgba(20, 20, 20, 0.8);
            backdrop-filter: blur(20px);
            border-right: 1px solid var(--border-subtle);
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.4s ease-out;
        }
        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.05); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: var(--brand-blue); }

        input, select, textarea {
            background: #1A1A1A !important;
            border: 1px solid rgba(255,255,255,0.05) !important;
            color: white !important;
        }

        .timer-progress {
            transition: stroke-dashoffset 0.3s ease;
        }

        .btn-brand {
            background: var(--brand-blue);
            box-shadow: 0 10px 30px rgba(46, 170, 220, 0.2);
        }

        .btn-brand:active { transform: scale(0.95); }

        .highlight-Business { border-left: 4px solid var(--cat-business); }
        .highlight-Fitness { border-left: 4px solid var(--cat-fitness); }
        .highlight-Learning { border-left: 4px solid var(--cat-learning); }
        .highlight-Spirituality { border-left: 4px solid var(--cat-spirituality); }
    </style>
<script type="importmap">
{
  "imports": {
    "@google/genai": "https://esm.sh/@google/genai@^1.35.0",
    "recharts": "https://esm.sh/recharts@^3.6.0",
    "react/": "https://esm.sh/react@^19.2.3/",
    "react": "https://esm.sh/react@^19.2.3",
    "lucide-react": "https://esm.sh/lucide-react@^0.562.0"
  }
}
</script>
</head>
<body class="h-screen flex">

    <!-- SIDEBAR -->
    <aside class="w-64 glass-sidebar h-full hidden md:flex flex-col z-50">
        <div class="p-8 flex items-center gap-4">
            <div class="w-10 h-10 bg-gradient-to-br from-[#2eaadc] to-[#1e7aa0] rounded-xl flex items-center justify-center text-xs font-black shadow-lg shadow-blue-500/20">Y</div>
            <h1 class="text-lg font-black tracking-tighter text-white/90 uppercase">Youssef</h1>
        </div>

        <nav class="flex-1 px-4 space-y-1">
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all">
                <i data-lucide="layout-dashboard" class="w-5 h-5"></i> Dashboard
            </button>
            <button onclick="switchTab('focus')" id="nav-focus" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all relative">
                <i data-lucide="timer" class="w-5 h-5"></i> 
                <div class="flex flex-col items-start">
                    <span>Focus</span>
                    <span id="sidebar-timer" class="text-[10px] text-[#2eaadc] hidden">00:00</span>
                </div>
            </button>
            <button onclick="switchTab('calendar')" id="nav-calendar" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all">
                <i data-lucide="calendar-days" class="w-5 h-5"></i> Calendar
            </button>
            <button onclick="switchTab('goals')" id="nav-goals" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all">
                <i data-lucide="target" class="w-5 h-5"></i> Goals
            </button>
            <button onclick="switchTab('habits')" id="nav-habits" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all">
                <i data-lucide="clipboard-list" class="w-5 h-5"></i> Habits
            </button>
            <button onclick="switchTab('archive')" id="nav-archive" class="nav-btn w-full flex items-center gap-4 px-4 py-3 rounded-xl text-[14px] font-bold text-white/30 hover:bg-white/[0.03] transition-all">
                <i data-lucide="edit-3" class="w-5 h-5"></i> Archive
            </button>
        </nav>

        <div class="p-6 border-t border-white/5">
            <div class="flex items-center gap-4 px-4 py-3 text-[14px] text-white/20 font-bold">
                <i data-lucide="settings" class="w-5 h-5 opacity-40"></i> Settings
            </div>
        </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="flex-1 overflow-y-auto custom-scrollbar">
        <div class="max-w-5xl mx-auto w-full p-8 md:p-16">
            
            <!-- DASHBOARD TAB -->
            <section id="tab-dashboard" class="tab-content active space-y-12">
                <header class="flex flex-col md:flex-row md:items-center justify-between gap-6 pb-8 border-b border-white/5">
                    <div class="space-y-1">
                        <h2 class="text-4xl font-black tracking-tighter uppercase">YOUSSEF PROTOCOL</h2>
                        <p id="motivation-text" class="text-[14px] text-white/40 font-medium italic">Loading inspiration...</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="px-6 py-3 bg-[#141414] border border-white/5 rounded-2xl text-center">
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block mb-1">Discipline</span>
                            <span id="discipline-score" class="text-xl font-black text-[#2eaadc]">0%</span>
                        </div>
                        <div class="px-6 py-3 bg-[#141414] border border-white/5 rounded-2xl text-center">
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block mb-1">Capital</span>
                            <span id="capital-total" class="text-xl font-black text-emerald-500">$0</span>
                        </div>
                    </div>
                </header>

                <!-- Daily Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                    <div class="p-6 bg-[#141414] border border-white/5 rounded-3xl shadow-xl flex items-center gap-5">
                        <div class="p-3 bg-blue-500/10 rounded-2xl"><i data-lucide="timer" class="w-5 h-5 text-[#2eaadc]"></i></div>
                        <div>
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block">Focus</span>
                            <span id="stat-focus" class="text-lg font-black text-white">0m</span>
                        </div>
                    </div>
                    <div class="p-6 bg-[#141414] border border-white/5 rounded-3xl shadow-xl flex items-center gap-5">
                        <div class="p-3 bg-emerald-500/10 rounded-2xl"><i data-lucide="coffee" class="w-5 h-5 text-emerald-500"></i></div>
                        <div>
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block">Rest</span>
                            <span id="stat-rest" class="text-lg font-black text-white">0m</span>
                        </div>
                    </div>
                    <div class="p-6 bg-[#141414] border border-white/5 rounded-3xl shadow-xl flex items-center gap-5">
                        <div class="p-3 bg-orange-500/10 rounded-2xl"><i data-lucide="zap" class="w-5 h-5 text-orange-500"></i></div>
                        <div>
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block">Sessions</span>
                            <span id="stat-sessions" class="text-lg font-black text-white">0</span>
                        </div>
                    </div>
                    <div class="p-6 bg-[#141414] border border-white/5 rounded-3xl shadow-xl flex items-center gap-5">
                        <div class="p-3 bg-purple-500/10 rounded-2xl"><i data-lucide="shield-check" class="w-5 h-5 text-purple-500"></i></div>
                        <div>
                            <span class="text-[9px] text-white/20 font-black uppercase tracking-widest block">Rank</span>
                            <span id="stat-rank" class="text-lg font-black text-white">Grinder</span>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Energy Protocol -->
                    <div class="p-8 bg-[#141414] border border-white/5 rounded-[32px] space-y-6 shadow-2xl">
                        <h3 class="text-[11px] font-black uppercase tracking-[0.3em] text-[#2eaadc] flex items-center gap-3">
                            <i data-lucide="smile" class="w-4 h-4"></i> Energy Protocol
                        </h3>
                        <div id="mood-selector" class="flex gap-3">
                            <!-- JS Inject -->
                        </div>
                        <button onclick="openArchiveModal()" class="w-full py-4 bg-white/5 hover:bg-white/10 text-white/60 rounded-2xl text-[11px] font-black uppercase tracking-widest transition-all border border-white/5">
                            ARCHIVE DAY
                        </button>
                    </div>
                    
                    <!-- Chart -->
                    <div class="p-8 bg-[#141414] border border-white/5 rounded-[32px] space-y-4 shadow-2xl relative min-h-[300px]">
                        <h3 class="text-[11px] font-black uppercase tracking-[0.3em] text-[#2eaadc] flex items-center gap-3 mb-4">
                            <i data-lucide="activity" class="w-4 h-4"></i> Execution Velocity
                        </h3>
                        <div class="h-48 w-full">
                            <canvas id="velocityChart"></canvas>
                        </div>
                    </div>
                </div>
            </section>

            <!-- FOCUS TAB -->
            <section id="tab-focus" class="tab-content space-y-12">
                <div class="max-w-xl mx-auto text-center space-y-4">
                    <h2 class="text-4xl font-black tracking-tighter uppercase">Focus Protocol</h2>
                    <p class="text-[11px] text-white/20 font-black tracking-[0.6em] uppercase">Time is your only non-renewable asset</p>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 items-center">
                    <div class="bg-[#141414] border border-white/5 rounded-[48px] p-12 shadow-3xl relative overflow-hidden text-center">
                        <div class="flex justify-center gap-3 mb-10">
                            <button onclick="changeTimerMode('focus')" class="timer-mode-btn px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all bg-white/10 text-white border border-white/10" id="mode-focus">Work</button>
                            <button onclick="changeTimerMode('shortBreak')" class="timer-mode-btn px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest text-white/20 hover:text-white/40" id="mode-shortBreak">Rest</button>
                        </div>

                        <div class="relative w-64 h-64 mx-auto flex items-center justify-center mb-10">
                            <svg class="absolute w-full h-full -rotate-90">
                                <circle cx="128" cy="128" r="120" stroke="rgba(255,255,255,0.05)" stroke-width="4" fill="transparent"/>
                                <circle id="timer-ring" cx="128" cy="128" r="120" stroke="#2eaadc" stroke-width="8" fill="transparent" stroke-dasharray="753.98" stroke-dashoffset="0" stroke-linecap="round" class="timer-progress"/>
                            </svg>
                            <div id="timer-display" class="text-6xl font-black tracking-tighter text-white tabular-nums">25:00</div>
                        </div>

                        <div class="flex items-center justify-center gap-6">
                            <button onclick="resetTimer()" class="p-5 bg-white/5 hover:bg-white/10 text-white/40 rounded-[24px] transition-all"><i data-lucide="rotate-ccw" class="w-6 h-6"></i></button>
                            <button id="timer-toggle-btn" onclick="toggleTimer()" class="w-24 h-24 bg-white text-black rounded-full flex items-center justify-center shadow-lg hover:scale-110 active:scale-95 transition-all"><i data-lucide="play" class="w-8 h-8 fill-black"></i></button>
                            <div class="p-5 opacity-0"><i data-lucide="rotate-ccw" class="w-6 h-6"></i></div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="p-8 bg-[#141414] border border-white/5 rounded-[40px] shadow-2xl space-y-6">
                            <h3 class="text-[11px] font-black uppercase tracking-[0.3em] text-[#2eaadc] flex items-center gap-3">
                                <i data-lucide="bar-chart-3" class="w-4 h-4"></i> Statistics
                            </h3>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between p-6 bg-white/[0.02] border border-white/5 rounded-3xl">
                                    <div class="flex items-center gap-4">
                                        <div class="p-3 bg-[#2eaadc]/10 rounded-2xl"><i data-lucide="zap" class="w-5 h-5 text-[#2eaadc]"></i></div>
                                        <div>
                                            <span class="text-[10px] font-black text-white/20 uppercase tracking-widest block">Deep Work</span>
                                            <span id="focus-mins-display" class="text-xl font-black text-white">0 MIN</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between p-6 bg-white/[0.02] border border-white/5 rounded-3xl">
                                    <div class="flex items-center gap-4">
                                        <div class="p-3 bg-emerald-500/10 rounded-2xl"><i data-lucide="coffee" class="w-5 h-5 text-emerald-500"></i></div>
                                        <div>
                                            <span class="text-[10px] font-black text-white/20 uppercase tracking-widest block">Rest Cycle</span>
                                            <span id="rest-mins-display" class="text-xl font-black text-white">0 MIN</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- GOALS TAB -->
            <section id="tab-goals" class="tab-content space-y-12">
                <div class="flex items-center justify-between">
                    <h2 class="text-4xl font-black tracking-tighter uppercase">Strategic Roadmap</h2>
                    <button onclick="openAddGoalModal()" class="px-6 py-3 btn-brand text-white rounded-xl text-[12px] font-black uppercase tracking-widest">+ New Goal</button>
                </div>
                <div id="goals-grid" class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <!-- JS Inject -->
                </div>
            </section>

            <!-- HABITS TAB -->
            <section id="tab-habits" class="tab-content space-y-12">
                <div class="flex items-center justify-between">
                    <h2 class="text-4xl font-black tracking-tighter uppercase">Protocols</h2>
                    <button onclick="openAddTaskModal()" class="px-6 py-3 btn-brand text-white rounded-xl text-[12px] font-black uppercase tracking-widest">+ Protocol</button>
                </div>
                <div id="habits-list" class="space-y-12">
                    <!-- JS Inject -->
                </div>
            </section>

            <!-- CALENDAR TAB -->
            <section id="tab-calendar" class="tab-content space-y-8">
                <div class="flex items-center justify-between">
                    <h2 id="calendar-month-title" class="text-3xl font-black uppercase tracking-tighter">Month</h2>
                    <div class="flex gap-3">
                        <button onclick="adjustMonth(-1)" class="p-3 bg-white/5 rounded-2xl hover:bg-white/10"><i data-lucide="chevron-left" class="w-5 h-5 opacity-40"></i></button>
                        <button onclick="adjustMonth(1)" class="p-3 bg-white/5 rounded-2xl hover:bg-white/10"><i data-lucide="chevron-right" class="w-5 h-5 opacity-40"></i></button>
                    </div>
                </div>
                <div id="calendar-grid" class="grid grid-cols-7 border-t border-l border-white/5 rounded-[40px] overflow-hidden shadow-2xl bg-[#141414]">
                    <!-- JS Inject -->
                </div>
            </section>

            <!-- ARCHIVE TAB -->
            <section id="tab-archive" class="tab-content space-y-8">
                <h2 class="text-4xl font-black tracking-tighter uppercase">Archive</h2>
                <div id="archive-list" class="grid gap-4">
                    <!-- JS Inject -->
                </div>
            </section>

        </div>
    </main>

    <!-- FAB -->
    <button onclick="openAddTaskModal()" class="fixed bottom-10 right-10 w-16 h-16 btn-brand text-white rounded-full flex items-center justify-center shadow-2xl hover:scale-110 active:scale-90 transition-all z-40 border-4 border-white/10">
        <i data-lucide="plus" class="w-8 h-8"></i>
    </button>

    <!-- MODALS -->
    <div id="modal-overlay" class="fixed inset-0 bg-black/90 backdrop-blur-xl z-[100] hidden items-center justify-center p-6">
        
        <!-- Add Task Modal -->
        <div id="modal-add-task" class="bg-[#141414] border border-white/10 w-full max-w-lg rounded-[48px] overflow-hidden hidden">
            <div class="p-10 flex justify-between items-center border-b border-white/5">
                <h3 class="text-2xl font-black uppercase tracking-tighter">New Protocol</h3>
                <button onclick="closeModals()" class="p-3 bg-white/5 hover:bg-white/10 rounded-2xl"><i data-lucide="x" class="w-6 h-6 opacity-30"></i></button>
            </div>
            <form onsubmit="handleAddTask(event)" class="p-10 space-y-10">
                <input required id="new-task-title" placeholder="E.G. READ 20 PAGES..." class="w-full bg-[#1A1A1A] border border-white/5 rounded-3xl p-6 text-sm font-bold uppercase tracking-widest focus:outline-none focus:border-blue-500/50" />
                <div class="grid grid-cols-2 gap-6">
                    <select id="new-task-category" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-[11px] font-black uppercase">
                        <option value="Business">Business</option>
                        <option value="Fitness">Fitness</option>
                        <option value="Spirituality">Spirituality</option>
                        <option value="Learning">Learning</option>
                    </select>
                    <select id="new-task-frequency" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-[11px] font-black uppercase">
                        <option value="Daily">Daily</option>
                        <option value="Weekly">Weekly</option>
                    </select>
                </div>
                <button type="submit" class="w-full py-6 btn-brand text-white rounded-[32px] font-black uppercase tracking-widest">INITIATE ENTRY</button>
            </form>
        </div>

        <!-- Add Goal Modal -->
        <div id="modal-add-goal" class="bg-[#141414] border border-white/10 w-full max-w-lg rounded-[48px] overflow-hidden hidden">
            <div class="p-10 flex justify-between items-center border-b border-white/5">
                <h3 class="text-2xl font-black uppercase tracking-tighter">New Goal</h3>
                <button onclick="closeModals()" class="p-3 bg-white/5 hover:bg-white/10 rounded-2xl"><i data-lucide="x" class="w-6 h-6 opacity-30"></i></button>
            </div>
            <form onsubmit="handleAddGoal(event)" class="p-10 space-y-8">
                <div class="space-y-4">
                    <label class="text-[9px] font-black uppercase text-white/20 tracking-[0.3em] ml-2">Objective Title</label>
                    <input required id="new-goal-title" placeholder="E.G. EARN $5K MONTHLY" class="w-full bg-[#1A1A1A] border border-white/5 rounded-3xl p-6 text-sm font-bold uppercase tracking-widest focus:outline-none focus:border-blue-500/50" />
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <label class="text-[9px] font-black uppercase text-white/20 tracking-[0.3em] ml-2">Category</label>
                        <select id="new-goal-category" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-[11px] font-black uppercase">
                            <option value="Business">Business</option>
                            <option value="Fitness">Fitness</option>
                            <option value="Spirituality">Spirituality</option>
                            <option value="Learning">Learning</option>
                        </select>
                    </div>
                    <div class="space-y-4">
                        <label class="text-[9px] font-black uppercase text-white/20 tracking-[0.3em] ml-2">Time Horizon</label>
                        <select id="new-goal-horizon" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-[11px] font-black uppercase">
                            <option value="Weekly">Weekly</option>
                            <option value="Monthly">Monthly</option>
                            <option value="SixMonth">6-Month</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-6">
                    <div class="space-y-4">
                        <label class="text-[9px] font-black uppercase text-white/20 tracking-[0.3em] ml-2">Target Value</label>
                        <input required type="number" id="new-goal-target" placeholder="5000" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-sm font-bold" />
                    </div>
                    <div class="space-y-4">
                        <label class="text-[9px] font-black uppercase text-white/20 tracking-[0.3em] ml-2">Unit</label>
                        <input required id="new-goal-unit" placeholder="$" class="w-full bg-[#1A1A1A] border border-white/5 rounded-2xl p-4 text-sm font-bold uppercase" />
                    </div>
                </div>
                <button type="submit" class="w-full py-6 btn-brand text-white rounded-[32px] font-black uppercase tracking-widest mt-4">LOCK IN TARGET</button>
            </form>
        </div>

        <!-- Archive Day Modal -->
        <div id="modal-archive-day" class="bg-[#141414] border border-white/10 w-full max-w-lg rounded-[48px] p-10 space-y-8 hidden">
            <h3 class="text-3xl font-black uppercase tracking-tighter text-white">Daily Recap</h3>
            <textarea id="archive-reflection" placeholder="Key takeaways from today..." class="w-full bg-[#1A1A1A] border border-white/5 rounded-3xl p-8 text-sm font-medium h-48 focus:outline-none focus:border-blue-500/30 uppercase tracking-widest placeholder:text-white/5 resize-none"></textarea>
            <div class="flex gap-4">
                <button onclick="closeModals()" class="px-6 py-5 bg-white/5 text-white/40 rounded-3xl font-black uppercase tracking-widest">Cancel</button>
                <button onclick="confirmArchiveDay()" class="flex-1 py-5 btn-brand text-white rounded-3xl font-black uppercase tracking-widest">Confirm Archive</button>
            </div>
        </div>
    </div>

    <script type="module">
        import { GoogleGenAI } from "@google/genai";

        // --- AUDIO SERVICE ---
        const audio = {
            ctx: null,
            init() { if (!this.ctx) this.ctx = new (window.AudioContext || window.webkitAudioContext)(); },
            playPop() {
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = 'sine';
                osc.frequency.setValueAtTime(400, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(200, this.ctx.currentTime + 0.05);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.05);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.05);
            },
            playSuccess() {
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.frequency.setValueAtTime(523, this.ctx.currentTime);
                osc.frequency.exponentialRampToValueAtTime(1046, this.ctx.currentTime + 0.1);
                gain.gain.setValueAtTime(0.05, this.ctx.currentTime);
                gain.gain.exponentialRampToValueAtTime(0.01, this.ctx.currentTime + 0.3);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.3);
            },
            playClick() {
                this.init();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.frequency.setValueAtTime(150, this.ctx.currentTime);
                gain.gain.setValueAtTime(0.02, this.ctx.currentTime);
                osc.connect(gain); gain.connect(this.ctx.destination);
                osc.start(); osc.stop(this.ctx.currentTime + 0.05);
            }
        };

        // --- STATE MANAGEMENT ---
        const defaultState = {
            goals: [
                { id: 'g1', title: 'Earn first $1,000 Online', horizon: 'SixMonth', category: 'Business', targetValue: 1000, currentValue: 0, unit: '$', isCompleted: false },
                { id: 'g2', title: 'Reach 85kg Body Weight', horizon: 'SixMonth', category: 'Fitness', targetValue: 85, currentValue: 78, unit: 'kg', isCompleted: false }
            ],
            tasks: [
                { id: 't1', title: 'Wake up at 5:30 AM', category: 'Spirituality', isCompleted: false, frequency: 'Daily', streakCount: 0 },
                { id: 't2', title: 'PRAY FAJAR', category: 'Spirituality', isCompleted: false, frequency: 'Daily', streakCount: 0 },
                { id: 't4', title: 'Finish 1 Thumbnail', category: 'Business', isCompleted: false, frequency: 'Daily', streakCount: 0 }
            ],
            summaries: [],
            calendarEvents: [],
            incomeTotal: 0,
            dailyMoods: {},
            focusMinutesToday: 0,
            restMinutesToday: 0,
            totalSessionsCompleted: 0,
            timerTimeLeft: 1500,
            isTimerActive: false,
            timerMode: 'focus'
        };

        let state = JSON.parse(localStorage.getItem('youssef_state')) || defaultState;

        function saveState() {
            localStorage.setItem('youssef_state', JSON.stringify(state));
        }

        // --- GEMINI AI ---
        const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
        async function fetchMotivation() {
            try {
                const response = await ai.models.generateContent({
                    model: 'gemini-3-flash-preview',
                    contents: "Generate a short, powerful, stoic motivational quote for a young Muslim entrepreneur. No emojis. One sentence.",
                    config: { temperature: 0.7 }
                });
                document.getElementById('motivation-text').innerText = response.text || "Discipline is the bridge between goals and accomplishment.";
            } catch (e) { console.error(e); }
        }

        // --- TIMER ENGINE ---
        let timerInterval;
        const MODES = {
            focus: { time: 25, color: '#2eaadc' },
            shortBreak: { time: 5, color: '#10B981' }
        };

        function updateTimerUI() {
            const mins = Math.floor(state.timerTimeLeft / 60);
            const secs = state.timerTimeLeft % 60;
            const display = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            document.getElementById('timer-display').innerText = display;
            document.getElementById('sidebar-timer').innerText = display;
            
            const total = MODES[state.timerMode].time * 60;
            const progress = (state.timerTimeLeft / total) * 753.98;
            document.getElementById('timer-ring').style.strokeDashoffset = 753.98 - progress;
            
            if (state.isTimerActive) {
                document.getElementById('sidebar-timer').classList.remove('hidden');
                document.getElementById('timer-toggle-btn').innerHTML = '<i data-lucide="pause" class="w-8 h-8 fill-black"></i>';
            } else {
                document.getElementById('timer-toggle-btn').innerHTML = '<i data-lucide="play" class="w-8 h-8 fill-black"></i>';
            }
            lucide.createIcons();
        }

        window.toggleTimer = () => {
            audio.playPop();
            state.isTimerActive = !state.isTimerActive;
            if (state.isTimerActive) {
                timerInterval = setInterval(() => {
                    if (state.timerTimeLeft > 0) {
                        state.timerTimeLeft--;
                        updateTimerUI();
                        saveState();
                    } else {
                        handleTimerEnd();
                    }
                }, 1000);
            } else {
                clearInterval(timerInterval);
            }
            updateTimerUI();
            saveState();
        };

        function handleTimerEnd() {
            clearInterval(timerInterval);
            audio.playSuccess();
            const type = state.timerMode === 'focus' ? 'focus' : 'rest';
            const mins = MODES[state.timerMode].time;
            
            if (type === 'focus') {
                state.focusMinutesToday += mins;
                state.totalSessionsCompleted++;
            } else {
                state.restMinutesToday += mins;
            }
            
            state.timerMode = state.timerMode === 'focus' ? 'shortBreak' : 'focus';
            state.timerTimeLeft = MODES[state.timerMode].time * 60;
            state.isTimerActive = false;
            
            saveState();
            renderAll();
        }

        window.resetTimer = () => {
            audio.playClick();
            state.isTimerActive = false;
            clearInterval(timerInterval);
            state.timerTimeLeft = MODES[state.timerMode].time * 60;
            updateTimerUI();
            saveState();
        };

        window.changeTimerMode = (m) => {
            audio.playClick();
            state.timerMode = m;
            state.isTimerActive = false;
            clearInterval(timerInterval);
            state.timerTimeLeft = MODES[m].time * 60;
            document.querySelectorAll('.timer-mode-btn').forEach(b => b.classList.remove('bg-white/10', 'text-white'));
            document.getElementById(`mode-${m}`).classList.add('bg-white/10', 'text-white');
            document.getElementById('timer-ring').style.stroke = MODES[m].color;
            updateTimerUI();
            saveState();
        };

        // --- RENDERING ---
        window.switchTab = (tabId) => {
            audio.playClick();
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
            
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('bg-white/5', 'text-white'));
            document.getElementById(`nav-${tabId}`).classList.add('bg-white/5', 'text-white');
            
            renderAll();
        };

        function renderDashboard() {
            const discipline = Math.round((state.tasks.filter(t => t.isCompleted).length / (state.tasks.length || 1)) * 100);
            document.getElementById('discipline-score').innerText = `${discipline}%`;
            document.getElementById('capital-total').innerText = `$${state.incomeTotal}`;
            
            document.getElementById('stat-focus').innerText = `${state.focusMinutesToday}m`;
            document.getElementById('stat-rest').innerText = `${state.restMinutesToday}m`;
            document.getElementById('stat-sessions').innerText = state.totalSessionsCompleted;
            document.getElementById('stat-rank').innerText = state.totalSessionsCompleted > 4 ? 'Elite' : 'Grinder';
            
            const moodContainer = document.getElementById('mood-selector');
            moodContainer.innerHTML = '';
            const moods = [{e: 'ðŸš€', l: 'LIT'}, {e: 'âš–ï¸', l: 'CALM'}, {e: 'ðŸ“‰', l: 'SLOW'}, {e: 'ðŸ› ï¸', l: 'GRIND'}];
            const today = new Date().toISOString().split('T')[0];
            moods.forEach(m => {
                const btn = document.createElement('button');
                btn.className = `flex-1 p-5 rounded-2xl border transition-all ${state.dailyMoods[today] === m.e ? 'bg-[#2eaadc]/10 border-[#2eaadc]/30 scale-[1.05]' : 'bg-white/[0.01] border-white/5 opacity-40 hover:opacity-100 hover:bg-white/[0.03]'}`;
                btn.innerHTML = `<div class="text-2xl mb-2">${m.e}</div><div class="text-[9px] font-black uppercase tracking-widest">${m.l}</div>`;
                btn.onclick = () => { audio.playPop(); state.dailyMoods[today] = m.e; saveState(); renderDashboard(); };
                moodContainer.appendChild(btn);
            });

            renderChart();
        }

        let myChart;
        function renderChart() {
            const canvas = document.getElementById('velocityChart');
            if (!canvas) return;
            const ctx = canvas.getContext('2d');
            if (myChart) myChart.destroy();
            const data = state.summaries.slice(-6).map(s => {
                const comp = s.tasksSnapshot.filter(t => t.isCompleted).length;
                return Math.round((comp / (s.tasksSnapshot.length || 1)) * 100);
            });
            const labels = state.summaries.slice(-6).map(s => s.date.split('-').slice(1).join('/'));
            
            myChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels.length ? labels : ['-', '-', '-', '-', '-', 'Live'],
                    datasets: [{
                        label: 'Discipline',
                        data: labels.length ? data : [0,0,0,0,0,0],
                        borderColor: '#2eaadc',
                        backgroundColor: 'rgba(46, 170, 220, 0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { grid: { display: false }, ticks: { color: 'rgba(255,255,255,0.2)', font: { size: 9, weight: 'bold' } } },
                        y: { display: false, min: 0, max: 100 }
                    }
                }
            });
        }

        function renderGoals() {
            const grid = document.getElementById('goals-grid');
            if (!grid) return;
            grid.innerHTML = '';
            state.goals.forEach(g => {
                const progress = Math.min(100, Math.round((g.currentValue / g.targetValue) * 100));
                const card = document.createElement('div');
                card.className = `bg-[#141414] border border-white/5 rounded-[32px] p-8 relative overflow-hidden group hover:border-[#2eaadc]/30 transition-all highlight-${g.category}`;
                card.innerHTML = `
                    <div class="absolute top-0 right-0 w-32 h-32 bg-[#2eaadc]/5 blur-3xl"></div>
                    <div class="flex justify-between items-start mb-8">
                        <div>
                            <h3 class="text-lg font-black text-white/95">${g.title}</h3>
                            <span class="text-[10px] text-white/30 uppercase font-black tracking-[0.3em]">${g.horizon}</span>
                        </div>
                        <button onclick="deleteGoal('${g.id}')" class="opacity-0 group-hover:opacity-100 p-2 text-red-500/20 hover:text-red-500 transition-all"><i data-lucide="trash-2" class="w-5 h-5"></i></button>
                    </div>
                    <div class="space-y-4">
                        <div class="flex justify-between items-end">
                            <span class="text-2xl font-black">${g.currentValue} <span class="text-xs text-white/20">/ ${g.targetValue} ${g.unit}</span></span>
                            <span class="text-xs font-black text-[#2eaadc]">${progress}%</span>
                        </div>
                        <div class="h-2 w-full bg-white/5 rounded-full overflow-hidden">
                            <div class="h-full transition-all duration-1000" style="width: ${progress}%; background-color: var(--cat-${g.category.toLowerCase()})"></div>
                        </div>
                        <div class="flex gap-2 pt-2">
                            <input type="number" id="input-goal-${g.id}" value="${g.currentValue}" class="w-20 bg-white/5 border border-white/5 rounded-lg px-2 text-xs" />
                            <button onclick="updateGoalProgress('${g.id}')" class="px-3 py-1 bg-[#2eaadc] text-white rounded-lg text-[10px] font-black uppercase">Update</button>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        window.updateGoalProgress = (id) => {
            const val = parseInt(document.getElementById(`input-goal-${id}`).value);
            state.goals = state.goals.map(g => g.id === id ? {...g, currentValue: val} : g);
            audio.playSuccess();
            saveState();
            renderGoals();
        };

        window.deleteGoal = (id) => {
            state.goals = state.goals.filter(g => g.id !== id);
            audio.playPop();
            saveState();
            renderGoals();
        };

        function renderHabits() {
            const list = document.getElementById('habits-list');
            if (!list) return;
            list.innerHTML = '';
            const categories = ['Spirituality', 'Fitness', 'Learning', 'Business'];
            categories.forEach(cat => {
                const catTasks = state.tasks.filter(t => t.category === cat);
                if (!catTasks.length) return;
                
                const section = document.createElement('div');
                section.className = 'space-y-4';
                section.innerHTML = `<h3 class="text-[11px] font-black uppercase tracking-[0.4em] text-white/20">${cat}</h3>`;
                
                catTasks.forEach(t => {
                    const row = document.createElement('div');
                    row.className = `px-6 py-4 flex items-center justify-between rounded-3xl border transition-all ${t.isCompleted ? 'bg-white/[0.01] border-white/5 opacity-40 scale-[0.98]' : 'bg-[#181818] border-white/5 hover:border-white/20'}`;
                    row.innerHTML = `
                        <div class="flex items-center gap-4 cursor-pointer" onclick="toggleTask('${t.id}')">
                            <i data-lucide="${t.isCompleted ? 'check-circle-2' : 'circle'}" class="w-6 h-6 ${t.isCompleted ? 'text-[#2eaadc]' : 'text-white/10'}"></i>
                            <span class="font-bold ${t.isCompleted ? 'line-through text-white/30' : ''}">${t.title}</span>
                        </div>
                        <div class="flex items-center gap-4">
                            <div class="text-[10px] font-black text-[#2eaadc] px-2 py-1 bg-white/5 rounded-lg">${t.streakCount}ðŸ”¥</div>
                            <button onclick="deleteTask('${t.id}')" class="p-2 text-white/10 hover:text-red-500 transition-all"><i data-lucide="trash-2" class="w-4 h-4"></i></button>
                        </div>
                    `;
                    section.appendChild(row);
                });
                list.appendChild(section);
            });
            lucide.createIcons();
        }

        window.toggleTask = (id) => {
            state.tasks = state.tasks.map(t => {
                if (t.id === id) {
                    const newStatus = !t.isCompleted;
                    if (newStatus) audio.playSuccess();
                    else audio.playPop();
                    return {...t, isCompleted: newStatus, streakCount: newStatus ? t.streakCount + 1 : Math.max(0, t.streakCount - 1)};
                }
                return t;
            });
            saveState();
            renderHabits();
        };

        window.deleteTask = (id) => {
            state.tasks = state.tasks.filter(t => t.id !== id);
            audio.playPop();
            saveState();
            renderHabits();
        };

        function renderCalendar() {
            const grid = document.getElementById('calendar-grid');
            if (!grid) return;
            grid.innerHTML = '';
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth();
            document.getElementById('calendar-month-title').innerText = now.toLocaleString('default', { month: 'long', year: 'numeric' });
            
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();
            
            for (let i = 0; i < firstDay; i++) {
                grid.innerHTML += `<div class="h-24 border-r border-b border-white/5 bg-white/[0.01]"></div>`;
            }
            
            for (let d = 1; d <= daysInMonth; d++) {
                const isToday = d === now.getDate();
                grid.innerHTML += `
                    <div class="h-24 border-r border-b border-white/5 p-3 hover:bg-white/[0.03] transition-all cursor-pointer">
                        <span class="text-[11px] font-black w-7 h-7 flex items-center justify-center rounded-lg ${isToday ? 'bg-[#2eaadc] text-white shadow-lg shadow-blue-500/20' : 'text-white/20'}">${d}</span>
                    </div>
                `;
            }
        }

        function renderArchive() {
            const list = document.getElementById('archive-list');
            if (!list) return;
            list.innerHTML = '';
            state.summaries.forEach(s => {
                const row = document.createElement('div');
                row.className = 'p-6 bg-[#141414] border border-white/5 rounded-3xl flex items-center justify-between hover:border-[#2eaadc]/30 transition-all cursor-pointer';
                row.innerHTML = `
                    <div class="flex items-center gap-6">
                        <span class="text-3xl">${s.mood}</span>
                        <div>
                            <span class="text-[10px] text-[#2eaadc] font-black uppercase mb-1 block">${s.date}</span>
                            <h3 class="text-lg font-black text-white/80">Execution Record</h3>
                        </div>
                    </div>
                    <i data-lucide="arrow-right" class="w-5 h-5 text-white/20"></i>
                `;
                list.appendChild(row);
            });
            if (!state.summaries.length) list.innerHTML = `<div class="text-center py-20 opacity-10 uppercase font-black text-[13px] tracking-widest">No records archived.</div>`;
            lucide.createIcons();
        }

        function renderAll() {
            const activeTabElem = document.querySelector('.tab-content.active');
            if (!activeTabElem) return;
            const activeTab = activeTabElem.id;
            
            if (activeTab === 'tab-dashboard') renderDashboard();
            if (activeTab === 'tab-focus') {
                updateTimerUI();
                document.getElementById('focus-mins-display').innerText = `${state.focusMinutesToday} MIN`;
                document.getElementById('rest-mins-display').innerText = `${state.restMinutesToday} MIN`;
            }
            if (activeTab === 'tab-goals') renderGoals();
            if (activeTab === 'tab-habits') renderHabits();
            if (activeTab === 'tab-calendar') renderCalendar();
            if (activeTab === 'tab-archive') renderArchive();
        }

        window.openAddTaskModal = () => {
            audio.playClick();
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.add('flex');
            document.getElementById('modal-add-task').classList.remove('hidden');
        };

        window.openAddGoalModal = () => {
            audio.playClick();
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.add('flex');
            document.getElementById('modal-add-goal').classList.remove('hidden');
        };

        window.openArchiveModal = () => {
            audio.playClick();
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('modal-overlay').classList.add('flex');
            document.getElementById('modal-archive-day').classList.remove('hidden');
        };

        window.closeModals = () => {
            document.getElementById('modal-overlay').classList.add('hidden');
            document.getElementById('modal-overlay').classList.remove('flex');
            document.getElementById('modal-add-task').classList.add('hidden');
            document.getElementById('modal-add-goal').classList.add('hidden');
            document.getElementById('modal-archive-day').classList.add('hidden');
        };

        window.handleAddTask = (e) => {
            e.preventDefault();
            const title = document.getElementById('new-task-title').value;
            const cat = document.getElementById('new-task-category').value;
            const freq = document.getElementById('new-task-frequency').value;
            if (!title) return;
            
            const newTask = { id: Date.now().toString(), title, category: cat, frequency: freq, isCompleted: false, streakCount: 0 };
            state.tasks.push(newTask);
            audio.playSuccess();
            saveState();
            closeModals();
            renderAll();
        };

        window.handleAddGoal = (e) => {
            e.preventDefault();
            const title = document.getElementById('new-goal-title').value;
            const cat = document.getElementById('new-goal-category').value;
            const hor = document.getElementById('new-goal-horizon').value;
            const tar = parseInt(document.getElementById('new-goal-target').value);
            const unit = document.getElementById('new-goal-unit').value;
            
            if (!title || isNaN(tar)) return;
            
            const newGoal = { 
                id: Date.now().toString(), 
                title, 
                horizon: hor, 
                category: cat, 
                targetValue: tar, 
                currentValue: 0, 
                unit, 
                isCompleted: false 
            };
            state.goals.push(newGoal);
            audio.playSuccess();
            saveState();
            closeModals();
            renderGoals();
        };

        window.confirmArchiveDay = () => {
            const ref = document.getElementById('archive-reflection').value;
            const today = new Date().toISOString().split('T')[0];
            const mood = state.dailyMoods[today] || 'Neutral';
            
            const summary = {
                date: today,
                mood: mood,
                reflection: ref,
                tasksSnapshot: state.tasks.map(t => ({ title: t.title, isCompleted: t.isCompleted }))
            };
            
            state.summaries.unshift(summary);
            state.focusMinutesToday = 0;
            state.restMinutesToday = 0;
            state.totalSessionsCompleted = 0;
            state.tasks = state.tasks.map(t => ({...t, isCompleted: false}));
            
            audio.playSuccess();
            saveState();
            closeModals();
            switchTab('archive');
        };

        // --- INIT ---
        window.addEventListener('load', () => {
            lucide.createIcons();
            renderAll();
            fetchMotivation();
            if (state.isTimerActive) {
                state.isTimerActive = false;
                window.toggleTimer();
            } else {
                updateTimerUI();
            }
        });

    </script>
</body>
</html>